<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="whang.travel.domain.bulletinboard.mybatis.PostMapper">

    <insert id="save" useGeneratedKeys="true" keyProperty="postId">
        insert into bulletinboard (member_id, title, content, category, post_date)
        values (#{memberId}, #{title}, #{content}, #{category}, #{postDate})
    </insert>

    <update id="update">
        update bulletinboard set title=#{updatePost.editTitle},
                                 content=#{updatePost.editContent},
                                 category=#{updatePost.editCategory},
                                 edit_date=#{updatePost.editDate}
        where post_id=#{postId}
    </update>

    <!-- 사용자가 작성한 게시글들을 리스트로 -->
    <select id="findPostByMemberId" resultType="Post">
        select post_id, member_id, title, content, category, post_date, edit_date
        from bulletinboard
        <where>
            member_id=#{memberId}
            <if test="searchTitle != null and searchTitle != ''">
                and title like concat('%', #{searchTitle}, '%')
            </if>
        </where>
    </select>

    <!-- 글의 상세 내용을 보여줄 때 -->
    <select id="findPostByPostId" resultType="Post">
        select post_id, member_id, title, content, post_date, category, edit_date
        from bulletinboard
        where post_id=#{postId}
    </select>

    <select id="findAll" resultType="Post">
        select post_id, member_id, title, content, category, post_date, edit_date
        from bulletinboard
        <where>
            <if test="searchTitle != null and searchTitle != ''">
                and title like concat('%', #{searchTitle}, '%')
            </if>
        </where>
    </select>

<!--    <select id="findMemberName" resultType="MemberName">-->
<!--        select first_name, last_name-->
<!--        from member-->
<!--        where member_id=#{memberId}-->
<!--    </select>-->

    <delete id="deletePost">
        delete
        from bulletinboard
        where post_id=#{postId}
    </delete>

<!--밑에 select 문에서 속성 순서 바뀌면 가끔 오류 생기던데 왜그러는거지? 이유 찾기 -->
    <select id="findAllWithMemberName" resultType="DisplayPostForm">
        select
        post_id, member.first_name, member.last_name, member.member_id, title,
        edit_date , category, content,  post_date
        from bulletinboard
        join member
        on bulletinboard.member_id = member.id
        <where>
            <if test="searchTitle != null and searchTitle != ''">
                and bulletinboard.title like concat('%', #{searchTitle}, '%')
            </if>
        </where>
    </select>

</mapper>
